<?  ##################################  # Name Class     Conexion.class.php  # Dependence     configV4.inc.php  # Created For    Paolo Viera  # Date           08-10-1997  # Update         15-03-2001  #  # Codigos de Errores  #         "COD2510" = Error de Conexion  #         "COD2530" = Error de Seleccion de Base de Datos  #         "COD2550" = Error de Query  ###################################  class Conexion {      var $host = HOST; // Usar constante definida en configV4.inc.php      var $user = DB_USER;      var $pass = DB_PASS;      var $db = DB;      var $link_id;      //-----------------------------FUNCION DE CONEXION      function conecta() {          // Depuración: Mostrar valores de conexión          // echo "EL HOST :" . $this->host . "<BR>EL USER :" . $this->user . "<BR>LA CLAVE :" . $this->pass . "<BR>LA DB :" . $this->db;          //-----------------------------Conectamos          $CONECT = @mysql_connect($this->host, $this->user, $this->pass);          //-----------------------------Controlamos si hubo conexión          if (!$CONECT) {              $this->msgError("COD2510", $this->ErrorMsgServer());              exit;          } else {              $this->link_id = $CONECT;          }          //-----------------------------Selección de Base de Datos          $db = @mysql_select_db($this->db, $CONECT);          //-----------------------------Controlamos si hubo selección de Base de Datos          if (!$db) {              $this->msgError("COD2530", $this->ErrorMsgServer());              exit;          } else {              return $CONECT;          }      }      //-----------------------------EXECUTE SQL STATEMENT      function execstmt($conn, $query) {          $result = mysql_query($query, $conn);          if (!$result) {              echo "El query $query es inválido: " . mysql_error();              $this->msgError("COD2550", $this->ErrorMsgServer());              exit;          }          return $result;      }      function myrows($result) {          return mysql_fetch_array($result);      }      //-----------------------------ETAPA DE MENSAJES DE ERRORES      function msgError($tipoError, $MsgServer) {          include("./inc/template/errores/" . $tipoError . "error.php");          if (MSGEMAILERROR == 1) {              $MsgErrorWebMatesr = $this->EmailMsgError($tipoError, $MsgServer);              $subject = "Error Grave en Sitio " . SITIOWEB;              $message = '              <html>              <head>                  <title>Error Grave en (' . SITIOWEB . ')</title>              </head>              <body>                  <p>ATENCION :</p>                  <table>                      <tr>                          <td align="center">                              <font face="verdana,sans-serif" size="3" color="#003399">                                  <b>' . $MsgErrorWebMatesr . '</b>                              </font>                          </td>                      </tr>                      <tr>                          <td><font face="verdana,sans-serif" size="2" color="#000000"><b>Soluciona de forma inmediata este problema o comuníquese con el creador de la aplicación</b></font></td>                      </tr>                  </table>              </body>              </html>              ';              $headers  = "MIME-Version: 1.0\r\n";              $headers .= "Content-type: text/html; charset=iso-8859-1\r\n";              $headers .= "From: " . FFROM;              $headers .= "X-Priority: 1\n"; // 1 Urgent Message, 3 Normal              $headers .= CC;              $headers .= BCC;              $headers .= "Return-Path: <mail@server.com>\n";              $sendemail = mail(TOO, $subject, $message, $headers);              if (!$sendemail) {                  echo "<font color=red>Error Grave: No se pudo enviar el mensaje de error a nuestros operadores, comuníquese con nuestra oficina.</font>";              }          }      }      //-----------------------------ENVIO DE ERRORES POR VÍA EMAIL      function EmailMsgError($tipoError, $MsgServer) {          return $this->MsgTextoError($MsgServer);      }      //-----------------------------TEXTO DE ERRORES PARA EL ENVÍO AL CLIENTE Y AL ADMINISTRADOR      function MsgTextoError($MsgServer) {          $msgEmailError = "Señor Webmaster Se ha Producido el siguiente Error de Conexión:<br>";          $msgEmailError .= $MsgServer;          return $msgEmailError;      }      //-----------------------------CAPTURA E INDICA CUANDO SE HA PRODUCIDO ERROR EN MYSQL      function ErrorMsgServer() {          if (mysql_errno() != 0) {              $errorCapturado = mysql_errno() . " : " . mysql_error();              return $errorCapturado;          } else {              return 0;          }      }      //-----------------------------FUNCION DE DESCONEXION      function desconecta() {          $DESCONN = @mysql_close($this->link_id);      }  } // end class  ?>